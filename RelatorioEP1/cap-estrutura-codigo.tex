%% ------------------------------------------------------------------------- %%
\chapter{Estrutura do código}
\label{cap:estrutura-codigo}

O sistema trata de:
\begin{enumerate}
\item Comunicação com \textit{webservers} e autenticação de usuário:
	\begin{itemize}
		\item Foi utilizado um \textit{webserver} especialmente desenvolvido para o projeto com a 
		funcionalidade de receber e responder requisições dos usuários utilizando a notação \textit{JavaScript Object Notation} (JSON).
		\item  Será realizada a autenticação de usuário por meio do login de usuários no STOA 
		(http://stoa.usp.br/).
	\end{itemize}
\item Funcionalidades extras dos dispositivos móveis:
	\begin{itemize}
		\item Câmera, Áudio, Vídeo, GPS, Acelerômetro.
		\item Compartilhamento de informações.
	\end{itemize}
\end{enumerate}

%% ------------------------------------------------------------------------- %%
\section{Principais classes para o aplicativo da Ouvidoria}

A Figura\ref{fig:Ouvidoria-EstruturaDoCodigo} exibe a estrutura de pastas e pacotes do aplicativo \textit{OmbudsmanAdm}, disponível em: https://github.com/rabriol/OmbudsmanAdm, que contém o conteúdo relacionado ao aplicativo acessado pelos funcionários da Segurança e Manutenção da USP. 

\begin{figure}[!h]
  \centering
  \includegraphics[width=.40\textwidth]{Ouvidoria-EstruturaDoCodigo} 
  \caption{Estrutura de pacotes Java do aplicativo da Ouvidoria}
  \label{fig:Ouvidoria-EstruturaDoCodigo} 
\end{figure}

Os pacotes do aplicativo da Ouvidoria começam com o padrão: br.com.usp.ime.ombudsmanadm. A partir desse prefixo, são adicionados os sufixos que especificam o conteúdo exato de cada pacote da pasta \textit{Source} (src). Os pacotes na hierarquia de classes Java do aplicativo da Ouvidoria finalizam com os sufixos \textit{Model, View, Preferences, Task e Util}.
O sistema foi implementado utilizando o padrão de projeto \textit{Model-View-Controller}(MVC), por esse motivo, as classes implementadas no pacote \textit{Model}, correspondem a classes que contém a lógica de negócios do sistema, bem como a lógica de manipulação das informações armazenadas no banco de dados. As classes Java inseridas no pacote \textit{View}, constituem as classes que tratam das interfaces ou visualização do sistema e as classes que estão em \textit{View.adapter} são as que fazem a intermediação entre as classes de visualização e de negócio do sistema, de modo a implementarem o controle entre a \textit{View} e o \textit{Model}.

O pacote \textit{Preferences} foi criado para gerenciar as preferências do usuário e registra quando o usuário está logado no sistema com seu identificador único. O pacote \textit{Task} contém as classes responsáveis pela comunicação com o servidor Web e que estendem a classe \textit{AsyncTask}. O pacote \textit{Util} contém as classes utilitárias do aplicativo da Ouvidoria. As principais classes Java do aplicativo da Ouvidoria serão explicados em maiores detalhes nas próximas subseções.

%% ------------------------------------------------------------------------- %%
\subsection{Principais classes do pacote Model}
\label{sec:model}

O pacote Model, a saber, br.com.usp.ime.ombudsmanadm.model é composto de Model.vo, Model.bo e Model.dao. Como dito anteriormente, o pacote Model é responsável pelas classes que implementam a lógica de negócio da aplicação e que fazem a manipulação de informações armazenadas no banco de dados.

O pacote Model.vo, refere-se às classes responsáveis pelos modelos de valores de objetos, ou \textit{Value Object} (VO). São as classes que representam os principais objetos manipulados pelo sistema: \textit{Category, Incident, Status e User}. Cada um desses objetos é representado por uma classe, com exceção do Status que é representado por um Enum. Todos possuem métodos \textit{Get} e \textit{Set} de modo que seja possível acessar, visualizar e modificar seus atributos.

O pacote Model.bo, refere-se às classes responsáveis pela lógica de negócios do sistema e que possui a classe \textit{IncidentConverter} que realiza a conversão de uma lista de incidentes para uma String JSON e a partir de uma String JSON obtém uma lista de Incidentes. Os métodos que realizam essas atividades, respectivamente, são: public String toJSON(List<Incident> incidents); e public List<Incident> toIncidentList(String json). Esses dois métodos são essenciais para que os dados recuperados no formato JSON do servidor Web possam ser convertidos em uma lista de incidentes que pode ser armazenada no banco de dados do sistema (SQLite) e a partir de uma lista de incidentes recuperadas do banco de dados é possível convertê-las para o formato JSON de modo a enviá-las para o servidor Web.

O pacote Model.dao contém as classes e interfaces de acesso ao banco de dados SQLite. A interface \textit{IncidentDAO} é responsável por capsular os métodos implementados na classe \textit{IncidentSQLiteDAO}, que correspondem a todos os métodos de manipulação da tabela Incidente no banco de dados, a saber, \textit{insert, update, delete, getIncidents, getIncidentsByKeyValue, 
getIncidentsById, getLastIncidentId e getIncidentById.} Além dos métodos de manipulação dos incidentes armazenados no banco, a classe também é responsável pela criação e atualização da tabela Incidentes por meio dos métodos, \textit{onCreate e onUpgrade}, respectivamente.
 
A classe \textit{IncidentSQLiteDAO} além de implementar a interface \textit{IncidentDAO}, também estende a classe \textit{SQLiteOpenHelper}. A classe \textit{SQLiteOpenHelper} é uma classe utilitária para gerenciar a criação de banco de dados e a gestão de versões, onde é possível criar subclasses implementando os métodos \textit{onCreate(SQLiteDatabase), onUpgrade(SQLiteDatabase, int, int)} e a \textit{SQLiteOpenHelper} cuida de abrir o banco de dados se este existir, criá-lo caso não exista e atualizá-lo se necessário.


A classe \textit{SQLiteBase} também estende a classe \textit{SQLiteOpenHelper} e é responsável por criar as tabelas \textit{Category} e \textit{User}, implementando os métodos \textit{onCreate} e \textit{onUpgrade}, de acordo com a herança de 
\textit{SQLiteOpenHelper}.


A classe abstrata \textit{BaseDAO} obtém uma instância de \textit{SQLiteBase} e define o método \textit{getDDL}, que é usado pelas classes \textit{CategoryDAO} e \textit{UserDAO}, para obter o \textit{Domain Definition Language} (DDL) das duas tabelas \textit{Category} e \textit{User}.

A classe CategoryDAO estende a classe abstrata BaseDAO e portanto implementa o método \textit{getDDL} com a criação da tabela \textit{Category}. A classe possui todos os métodos de manipulação do objeto \textit{Category}, que refere-se aos departamentos da Universidade de São Paulo, portanto possui os métodos \textit{insert(Category), insert(List<Category>), getAll e 
getCategoryFrom(Cursor)}. 

A classe \textit{UserDAO} também estende a classe abstrata \textit{BaseDAO} e portanto implementa o método \textit{getDDL} com a criação da tabela \textit{User}. Assim como a classe \textit{CategoryDAO}, realiza a manipulação dos dados de usuário e 
implementa os métodos \textit{insert(User), getUniqueUser e getUserFrom(Cursor).}
 

%% ------------------------------------------------------------------------- %%
\subsection{Principais classes do pacote View}
\label{sec:view}

O pacote \textit{View} contém as classes que tratam das interfaces ou visualização do sistema e as classes que estão em \textit{View.adapter} são as que fazem a intermediação entre as classes de visualização e de negócio do sistema, de modo a implementarem o controle entre a \textit{View} e o \textit{Model}.

Dentro do pacote View e View.map, temos todas as classes que estão associadas a interfaces do sistema e que possuem em comum o sufixo \textit{Activity}, representando uma \textit{Activity} do \textit{Android}.

A classe \textit{IncidentActivity} é responsável pela apresentação da lista de incidentes, por meio do método\textit{ onCreate(Bundle)}, por apresentar as opções de menu por meio do método \textit{onCreateOptionsMenu(Menu)} e por abrir 
as telas de acordo com a seleção do menu por meio do método \textit{onOptionsItemSelected(MenuItem).} 

As opções embora sejam descritas em código como opções de menu, são exibidas na tela por meio de ícones de acesso ao mapa, a busca por palavras-chave, entre outras opções. O método \textit{onSynchReturn} limpa a lista e traz todos os incidentes novos do 
servidor Web após adaptá-los de \textit{Json} para uma lista de incidentes que será exibida na interface.

A classe \textit{IncidentFormActivity} é responsável pela edição de um incidente cadastrado pelo usuário, por meio do aplicativo voltado para membros da comunidade USP. No aplicativo da Ouvidoria, que tem como público-alvo os funcionário da área de Segurança e Manutenção da USP, esta interface possibilita que mudem o status de tratamento de cada incidente de aberto para Em andamento, Resolvido ou Escondido. Esta interface exibe todos os detalhes cadastrados para cada incidente, incluindo foto, informações geográficas do GPS, departamento, entre outras.

\textit{LoginActivity} é responsável pelo login do funcionário da USP no sistema de Ouvidoria, que será realizado baseado no cadastro do funcionário na rede STOA. A interface retornará uma mensagem de sucesso para funcionários cadastrados no STOA e retornará uma mensagem de erro caso o funcionário não possua uma conta no STOA e portanto não pode acessar o sistema. Caso o usuário efetue login com sucesso, serão inicializada a \textit{activity} para listar os incidentes deste usuário. 

A classe \textit{SearchResultActivity} é responsável por exibir os resultados encontrados para a busca por palavras-chave. A interface apresenta a quantidade de resultados encontrados para a busca realizada. A classe \textit{SortedDepartmentActivity} é responsável pela ordenação dos incidentes por departamento da USP e por fim, a classe \textit{SortedIncidentActivity} é responsável pela ordenação dos incidentes.

A classe \textit{IncidentsMapActivity} no pacote \textit{View.map} é responsável pela apresentação dos incidentes registrado em um mapa, de acordo com a posição GPS dos incidentes registrados. Cada incidente é apresentado com um marcador que exibe sua descrição e o departamento da USP que ocorreu. O mapa é centralizado no Instituto de Matemática e Estatística (IME) da USP. Esta classe usa a classe \textit{GoogleMap} para exibir o mapa na interface.

Como classes do \textit{Controller} (Controlador) temos as classes do pacote \textit{View.Adapter} que adaptam os atributos a serem exibidos na interface de acordo com mudanças no conteúdo de cada objeto.

Na classe \textit{IncidentListAdapter} os incidentes de uma lista são atualizados de acordo com a mudança de status de tratamento. Por exemplo, os incidentes com status em aberto são coloridos com a cor vermelha, definida no arquivo res/values/colors.xml. Para o status resolvido, a cor passa a ser verde, para o status em andamento a cor é amarela. O mesmo ocorre na classe \textit{SearchListAdapter}, para o resultado de uma busca. A classe \textit{SortedIncidentListAdapter} apenas configura para que cada incidente de uma lista de incidentes seja exibido com uma cor diferente de linha para facilitar a sua visualização. A cor também neste caso é definida no arquivo res/values/colors.xml.


%% ------------------------------------------------------------------------- %%
\subsection{Principais classes do pacote Preferences}
\label{sec:preferences}
Como dito anteriormente, o pacote \textit{Preferences} foi criado para gerenciar as preferências do usuário e registra quando o usuário está logado no sistema com seu identificador único. O pacote possui duas classes: \textit{SharedPreferencesManager} e \textit{Preferences}.

A classe \textit{SharedPreferencesManager} gerencia as preferências compartilhadas para o aplicativo da Ouvidoria, possibilitando acessar, visualizar e atualizar as preferências para o aplicativo da Ouvidoria, por meio de métodos \textit{Get} e \textit{Set}. A classe \textit{Preferences} recupera uma instância de \textit{SharedPreferencesManager} e recupera as categorias de localização (departamentos da USP) e o usuário logado. 

%% ------------------------------------------------------------------------- %%
\subsection{Principais classes do pacote Task}
\label{sec:task}
O pacote \textit{Task} contém as classes responsáveis pela comunicação com o servidor Web e que estendem a classe \textit{AsyncTask}. A classe \textit{AsyncTask} permite realizar operações em \textit{background} e publicar resultados sobre a \textit{thread} de interface de usuário sem precisar manipular \textit{threads} e/ou \textit{handlers}. Esta classe foi projetada para ser uma classe utilitária em torno das classes \textit{Thread} e \textit{Handler} e não constitui um arcabouço de \textit{threading} genérico. A classe deve idealmente ser usada para curtas operações, que devem ser de poucos segundo no máximo. 

A classe \textit{IncidentSorterTask} é responsável por ordenar os incidentes por departamento, utilizando-se da classe \textit{DeptConverter} para realizar a conversão de departamentos. A classe \textit{IncidentSynchronizerTask} é responsável por sincronizar o aplicativo com o servidor Web, por meio da URL http://uspservices.deusanyjunior.dj/incidente/\%s.json, de modo a obter os últimos incidentes registrados no servidor e apresentá-los na lista de incidentes do funcionário. Essa operação depende de uma conexão com a Internet, que caso não esteja ativa, retornará uma mensagem indicando que não existe conexão com a Internet para realizar a operação.

A classe \textit{LoginTask} é responsável pelo login do usuário (funcionário da área de Segurança e Manutenção da USP) no aplicativo da Ouvidoria. O login e senha do usuário será verificado em https://maxwell.stoa.usp.br/plugin/stoa/authenticate. Se o usuário possuir uma conta no STOA, será retornada uma mensagem de sucesso e a tela com a lista de incidentes será apresentada. Enquanto o aplicativo acessa a url acima, uma mensagem de progresso da operação é apresentada ao usuário: "Verificando usuário.. ".

A classe \textit{QueryExecutorTask} é responsável por buscar os incidentes no banco de dados e apresenta mensagem de progresso na operação para o usuário e, por fim, a classe \textit{SendIncidentsTask} é responsável por enviar os incidentes armazenados no banco de dados SQLite para o servidor Web por meio da URL: http://uspservices.deusanyjunior.dj/incidente. Também uma mensagem com o progresso da operação é exibida ao usuário.

%% ------------------------------------------------------------------------- %%
\subsection{Principais classes do pacote Util}
\label{sec:util}
O pacote \textit{Util} contém as classes utilitárias do aplicativo da Ouvidoria. A classe \textit{ConnectionException} trata de exceções que podem ocorrer durante a conexão com o servidor Web. A classe \textit{DeptConverter} é responsável pela conversão de uma abreviatura de departamento para o nome completo do departamento e vice-versa.

A classe \textit{LoginParser} por realizar a conversão de uma string JSON que traz os dados de login, a saber, número USP, e-mail e \textit{username} para um objeto \textit{User}, e seta o objeto \textit{User} em um objeto \textit{LoginResponse} que é uma classe também no pacote \textit{Util} que representa um objeto login com os dados de login recebidos via JSON e o status recebido via JSON, sendo status Ok para quando o objeto JSON retorna um login válido ou uma string de erro que será setada em \textit{LoginResponse}, caso o login não seja efetuado com sucesso.

A classe \textit{NetworkAvailability} utiliza-se da classe \textit{ConnectivityManager} para gerenciar a conectividade da rede e da classe \textit{NetworkInfo} para obter informações da rede, retornando uma classe \textit{TypeNetworkAnalyser} que retorna o tipo de rede em uso pelo usuário, verificando se é uma rede 3G, se é uma rede \textit{Wifi}.

Por fim, temos a classe \textit{WebClient} que é uma classe importante para realizar a conexão com o servidor Web, implementando os métodos \textit{Http Get} e \textit{Http Post}, os quais recuperam e enviam dados via JSON para o servidor Web, respectivamente.

%Breve explicação do funcionamento da implementação de cada parte significativa do programa.

%% ------------------------------------------------------------------------- %%
\section{Principais classes para o aplicativo do Usuário}

Os pacotes do aplicativo do usuário começam com o padrão br.com.ouvidoria.client. A partir desse prefixo, são adicionados os sufixos que especificam o conteúdo exato de cada pacote da pasta \textit{Source} (src). Os pacotes na hierarquia de classes Java do aplicativo do Usuário para registro de incidentes finalizam com os sufixos dao, location, model, preferences, receiver, task, util, view e web.

As classes no pacote Dao fazem acesso e manipulam informações armazenadas no banco de dados. O pacote Location é responsável pela implementação para ter acesso à localização do usuário. O pacote Model contém a lógica de negócios do sistema. O pacote Preferences é responsável pela configuração de preferências do usuário. O pacote Receiver é responsável por enviar uma mensagem ao usuário quando o incidente por ele registrado for recebido com sucesso no servidor Web. O pacote Task executa tarefas por meio da conexão com o servidor Web. O pacote útil contém todos as classes utilitárias que são utilizadas para garantir a execução do projeto. O pacote View é responsável pelo tratamento das interfaces ou visualização do sistema e por fim, o pacote Web que contém a classe WebClient, principal responsável pela conexão com o servidor Web via JSON.

\begin{figure}[!h]
  \centering
  \includegraphics[width=.40\textwidth]{Usuario-Codigo1} 
  \caption{Primaira parte da estrutura de pacotes Java do aplicativo d Usuário}
  \label{fig:Usuario-Codigo1} 
\end{figure}

\begin{figure}[!h]
  \centering
  \includegraphics[width=.40\textwidth]{Usuario-Codigo2} 
  \caption{Segunda parte da estrutura de pacotes Java do aplicativo d Usuário}
  \label{fig:Usuario-Codigo2} 
\end{figure}

\subsection{Principais classes do pacote Dao}
O pacote \textit{Dao} contém as classes de acesso ao banco de dados SQLite. A classe \textit{SQLiteBase} estende a classe \textit{SQLiteOpenHelper}, como descrito na seção \ref{sec:model}, sobre Model.Dao. A classe tem o objetivo de criar o banco OuvidoriaBD e todas as tabelas do aplicativo do usuário, a saber, \textit{Category, Incident e User.}

A classe abstrata BaseDao é responsável por recuperar o contexto da classe \textit{SQLiteBase} e é estendida por todas as classes de acesso às tabelas do banco: \textit{CategoryDAO, IncidentDAO e UserDAO}. Cada uma dessas classes realiza manipulações com informações de categorias (ou departamentos da USP), incidentes e usuários, respectivamente.

\subsection{Principais classes do pacote Location}
O pacote Location contém a classe \textit{MyLocationListener} que implementa \textit{LocationListener}. Esta classe tem como objwetivo recuperar a localização do usuário, utilizando-se das classes \textit{LocationListenerCallback} e \textit{LocationManager}, as quais possibilitam encontrar o usuário pelo provedor da rede, mesmo que o GPS esteja desligado.


\subsection{Principais classes do pacote Model}
O pacote Model contém os valores de modelos de objetos que são manipulados pelo aplicativo, ou seja, (Value-Object), os quais representam os principais objetos do sistema, a saber, User, Incident, Category e Local. Todos são descritos por meio de classes Java que permitem o acesso, visualização e alteração de seus atributos por meio de métodos \textit{Get} e \textit{Set}. 


\subsection{Principais classes do pacote Preferences}
O pacote Preferences contém as classes \textit{SharedPreferencesManager} e \textit{Preferences}. A classe \textit{SharedPreferencesManager} gerencia as preferências compartilhadas para o aplicativo do Usuário, possibilitando acessar, visualizar e atualizar as preferências para o aplicativo, por meio de métodos \textit{Get} e \textit{Set}. A classe \textit{Preferences} recupera uma instância de \textit{SharedPreferencesManager} e recupera as categorias de localização (departamentos da USP) e o usuário logado. 

\subsection{Principais classes do pacote Receiver}
O pacote \textit{Receiver} contém a classe \textit{ConectionReceiver}. A classe ConectionReceiver estende a classe \textit{BroadcastReceiver} e implementa o método \textit{onReceive}, responsável por enviar uma mensagem ao usuário quando o incidente por ele registrado for recebido com sucesso pelo servidor Web. O incidente enviado para o servidor Web é removido do banco de dados SQLite.

\subsection{Principais classes do pacote Task}
O pacote \textit{Task} contém as classes responsáveis pela comunicação com o servidor Web e que estendem a classe \textit{AsyncTask}. A classe \textit{AsyncTask} permite realizar operações em \textit{background} e publicar resultados sobre a \textit{thread} de interface de usuário sem precisar manipular \textit{threads} e/ou \textit{handlers}. Esta classe foi projetada para ser uma classe utilitária em torno das classes \textit{Thread} e \textit{Handler} e não constitui um arcabouço de 
\textit{threading} genérico. A classe deve idealmente ser usada para curtas operações, 
que devem ser de poucos segundo no máximo.

A classe CategoryTask é responsável por recuperar as categorias de local do servidor Web. As categorias são os departamentos da USP. A classe estende AsyncTask e recupera as categorias por meio da 
URL http://uspservices.deusanyjunior.dj/categoriaslocal.json.

A classe \textit{LoginParser} é resposável por realizar a conversão de uma string JSON que traz os dados de login e \textit{status} de login, a saber: número USP, e-mail, \textit{username} e \textit{status} para o objeto \textit{LoginResponse}. Esta classe contém informações se o login foi efetuado com sucesso ou não e as respectivas informações de erro ou informações do login.

A classe \textit{SendIncidentTask} é responsável por enviar os incidentes para o servidor Web por meio da URL: http://uspservices.deusanyjunior.dj/incidente. Ela também exibe uma mensagem com o progresso da operação para o usuário.

A classe \textit{SendIncidentBackgroundTask} fica atenta as alterações de conexão de dados e quando identifica uma conexão ativa, verifica se há incidentes no banco de dados, havendo, os envia para o servidor Web por meio da URL: http://uspservices.deusanyjunior.dj/incidente. Apenas haverá incidentes no banco de dados caso no momento do salvamento do incidente, não foi possível enviá-lo ao servidor por falta de conexão de dados. Após o envio em background do incidente, é enviada uma mensagem informativa ao usuário e apagado do banco o incidente em questão.

Dentro do pacote \textit{Task}, exite o pacote parser, que contém as classes responsáveis 
pela conversão dos objetos para JSON e vice-versa. A classe \textit{CategoryParser} 
realiza a conversão de uma string JSON para uma lista de Category.
A classe \textit{IncidentParser} realiza a conversão de um \textit{Incident} para uma string 
JSON. E por fim, a classe \textit{LoginParser} realiza a conversão de uma string JSON para um objeto 
\textit{LoginResponse}.

\subsection{Principais classes do pacote Util}

O pacote Util contém as classes ImageUtil, MassageUtil e NetworkUtil para auxiliarem respectivamente no tratamento de imagens, mensagens e conexão com a rede. A classe \textit{ImageUtil} se utiliza das classes \textit{Bitmap}, \textit{ByteArrayOutputStream}, \textit{Base64} e \textit{BitmapFactory} que torna possível recuperar a imagem no formato de 64bits.

\subsection{Principais classes do pacote View}
O pacote \textit{View} contém as classes responsáveis pela visualização das informações pelo usuário. 

A classe \textit{ListIncidentFragment} é responsável pela visualização da lista de incidentes pendentes de envio ao servidor. Ela extende a classe \textit{Fragment} que faz parte da API Fragment que auxilia na criação de telas responsivas.

A classe \textit{LoginActivity} é resposável pela visualização da tela de login ao qual o usuário usa para se logar no sistema. Ela extende de \textit{Activity} que é a classe responsável pela criação de telas no Android.

A classe \textit{MainActivity} é responsável por compôr menu e conteúdo de tela e por realizar a transição dos fragmentos criados.

A classe \textit{NavigationDrawerFragment} é responsável por montar e exibir o menu lateral denominado padrão \textit{Navigation Drawer}. 

A classe \textit{NewIncidentFragment} é responsável por apresentar a tela de cadastro do incidente a ser enviado ao servidor. Esta é a tela apresentada imediatamente após realizado com sucesso o login. Ela extende a classe \textit{Fragment} que faz parte da API Fragment que auxilia na criação de telas responsivas. 


\subsection{Principais classes do pacote Web}

O pacote Web contém a classe WebClient, principal responsável pela conexão com o servidor Web via JSON. A classe \textit{WebClient} é uma classe importante para realizar a conexão com o servidor Web, implementando os métodos \textit{Http Get} e \textit{Http Post}, os quais recuperam e enviam dados via JSON para o servidor Web, respectivamente.

\section{\textit{Web Services}}

Para o serviço de autenticação no STOA foi necessário utilizar os seguintes dados via \textit{JavaScript Object Notation} (JSON) com um contrato via Post, passando o número USP e a senha do usuário:
URL: https://social.stoa.usp.br/plugin/stoa/authenticate/\\

Quando senha inválida: Retorna "ok":false,"error":"O par usuário/senha está incorreto."\\
Quando senha correta: Retorna "ok":true,"nusp":"0000000","username":"xxx","email":"xxx\@usp.br".\\

Os registros de incidentes são enviados por meio de um contrato via post, informado o número USP, a descrição do incidente, a categoria da localização, o valor da latitude da localização do incidente em tipo Float, longitude da localização do incidente em tipo Float e a foto do incidente, um binário da imagem em Base 64, para a seguinte URL:\\
http://uspservices.deusanyjunior.dj/incidente\\

%Contrato via Post: 
%{
 % "incidentrecord": {
  %  "user": "numero\_usp",
   % "description": "descricao\_do\_incidente",
   % "localization": "categoria\_da\_localizacao",
   % "latitude": "valor\_da\_latitude\_em\_float",
   % "longitude": "valor\_da\_longitude\_em\_float",
   % "photo": "binario\_da\_imagem\_em\_Base64"
  %}
%}

É possível requisitar novos incidentes, solicitando o último incidente registrado:\\
http://uspservices.deusanyjunior.dj/incidente.xml (ou .json)\\

Solicitar todos os incidentes a partir de um determinado incidente:\\
http://uspservices.deusanyjunior.dj/incidente/20.xml (ou .json)\\
obs.: No exemplo acima, retornaria todos os incidentes a partir do vigésimo incidente.\\

Solicitar incidentes em uma faixa específica:\\
http://uspservices.deusanyjunior.dj/incidentrecords/get\_incidents.xml?first=1\&last=3\\
obs.: Retorna todos os incidentes dentro de um intervalo especificado. No exemplo acima, retornaria a partir do incidente de id 1 até o de id 3.\\

Solicitar incidentes em uma faixa específica em uma determinada localização:\\
http://uspservices.deusanyjunior.dj/incidentrecords/get\_incidents.xml?first=1\&last=3\&localization=\\Instituto\%20de\%20Matemática\%20e\%20Estatística\\
obs.: No exemplo acima, retornaria todos os incidentes a partir do id 1 até o id 3 que fazem parte do Instituto de Matemática e Estatística da USP (IME).\\